<!DOCTYPE html>
<html>
<head>
    <title>Staffnexa Admin - Client Enquiries</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-100 min-h-screen">

<!-- NAVBAR -->
<nav class="bg-blue-700 text-white px-6 py-4 flex justify-between items-center">
    <div class="flex items-center gap-3">
        <img src="logo.png" class="h-10">
        <h1 class="text-xl font-bold">Staffnexa Admin</h1>
    </div>
    <button onclick="logout()" class="bg-white text-blue-700 px-4 py-1 rounded">
        Logout
    </button>
</nav>

<div class="max-w-7xl mx-auto p-6">

    <div class="flex justify-between mb-4">
        <input id="searchInput" 
               onkeyup="applyFilters()" 
               placeholder="Search company/contact"
               class="border p-2 rounded w-1/3">

        <select id="roleFilter" 
                onchange="applyFilters()" 
                class="border p-2 rounded">
            <option value="">All Roles</option>
            <option value="Pantry">Pantry</option>
            <option value="Housekeeping">Housekeeping</option>
            <option value="Security">Security</option>
        </select>

        <button onclick="exportCSV()" 
                class="bg-green-600 text-white px-4 py-2 rounded">
            Export CSV
        </button>
    </div>

    <table class="min-w-full bg-white shadow rounded">
        <thead class="bg-gray-200">
            <tr>
                <th class="p-3 text-left">Company</th>
                <th class="p-3 text-left">Contact</th>
                <th class="p-3 text-left">Role</th>
                <th class="p-3 text-left">Timeline</th>
                <th class="p-3 text-right">Action</th>
            </tr>
        </thead>
        <tbody id="tableBody"></tbody>
    </table>

</div>

<script>

const API_URL = "YOUR_BACKEND_URL/api/client-enquiries";

let enquiries = [];

async function loadEnquiries() {
    const res = await fetch(API_URL);
    enquiries = await res.json();
    renderTable(enquiries);
}

function renderTable(data) {
    const tbody = document.getElementById("tableBody");
    tbody.innerHTML = "";

    data.forEach(e => {
        tbody.innerHTML += `
            <tr class="border-t">
                <td class="p-3">${e.companyName}</td>
                <td class="p-3">${e.contactPerson} <br> ${e.phone}</td>
                <td class="p-3">${e.role}</td>
                <td class="p-3">${e.timeline}</td>
                <td class="p-3 text-right">
                    <button onclick="deleteEnquiry('${e._id}')"
                            class="bg-red-600 text-white px-3 py-1 rounded">
                        Delete
                    </button>
                </td>
            </tr>
        `;
    });
}

function applyFilters() {
    const search = document.getElementById("searchInput").value.toLowerCase();
    const role = document.getElementById("roleFilter").value;

    const filtered = enquiries.filter(e => {
        const matchesSearch =
            e.companyName.toLowerCase().includes(search) ||
            e.contactPerson.toLowerCase().includes(search);

        const matchesRole =
            role === "" || e.role === role;

        return matchesSearch && matchesRole;
    });

    renderTable(filtered);
}

async function deleteEnquiry(id) {
    if (!confirm("Delete this enquiry?")) return;

    await fetch(`${API_URL}/${id}`, {
        method: "DELETE"
    });

    loadEnquiries();
}

function exportCSV() {
    let csv = "Company,Contact,Phone,Role,Timeline\n";

    enquiries.forEach(e => {
        csv += `${e.companyName},${e.contactPerson},${e.phone},${e.role},${e.timeline}\n`;
    });

    const blob = new Blob([csv], { type: "text/csv" });
    const url = window.URL.createObjectURL(blob);

    const a = document.createElement("a");
    a.href = url;
    a.download = "staffnexa-enquiries.csv";
    a.click();
}

function logout() {
    localStorage.removeItem("token");
    window.location.href = "login.html";
}

loadEnquiries();

</script>

</body>
</html>
