<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Staffnexa Dashboard</title>

    <style>
        body {
            font-family: Arial;
            background: #f5f7fa;
            padding: 20px;
        }

        h1 { margin-bottom: 20px; }

        .search-box {
            padding: 8px;
            width: 250px;
            margin-bottom: 15px;
        }

        .table-container {
            background: #fff;
            padding: 20px;
            border-radius: 10px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 12px;
            border-top: 1px solid #eee;
        }

        thead {
            background: #f0f2f5;
        }

        .delete-btn {
            color: red;
            cursor: pointer;
        }

        .center {
            text-align: center;
            padding: 20px;
        }

        .error {
            color: red;
        }
    </style>
</head>
<body>

<h1>Candidate Applications</h1>

<input type="text" id="search" class="search-box" placeholder="Search...">

<div class="table-container">
<table id="candidateTable">
<thead>
<tr>
<th>Name</th>
<th>Phone</th>
<th>Role</th>
<th>Location</th>
<th>Date</th>
<th>Action</th>
</tr>
</thead>

<tbody id="tableBody">
<tr><td colspan="6" class="center">Loading...</td></tr>
</tbody>
</table>
</div>

<script>

const API_URL = "https://jobapp.staffnexats.com/candidates";

// ðŸ”¥ same as backend
const USERNAME = "admin";
const PASSWORD = "admin123";

function authHeader() {
    return "Basic " + btoa(USERNAME + ":" + PASSWORD);
}

async function fetchCandidates() {

    const table = document.getElementById("tableBody");

    try {
        const res = await fetch(API_URL, {
            method: "GET",
            headers: {
                "Authorization": authHeader(),
                "Content-Type": "application/json"
            }
        });

        if (!res.ok) {
            throw new Error("API error: " + res.status);
        }

        const data = await res.json();

        table.innerHTML = "";

        data.forEach(c => {
            const row = document.createElement("tr");

            row.innerHTML = `
                <td>${c.name || "-"}</td>
                <td>${c.phone || "-"}</td>
                <td>${c.role || "-"}</td>
                <td>${c.location || "-"}</td>
                <td>${c.createdAt ? new Date(c.createdAt).toLocaleString() : "-"}</td>
                <td><span class="delete-btn" onclick="del('${c._id}')">Delete</span></td>
            `;

            table.appendChild(row);
        });

    } catch (err) {
        table.innerHTML = `
            <tr>
                <td colspan="6" class="center error">${err.message}</td>
            </tr>
        `;
    }
}

async function del(id) {
    if (!confirm("Delete?")) return;

    await fetch(API_URL + "/" + id, {
        method: "DELETE",
        headers: {
            "Authorization": authHeader()
        }
    });

    fetchCandidates();
}

document.getElementById("search").addEventListener("keyup", function() {
    let val = this.value.toLowerCase();
    document.querySelectorAll("#candidateTable tbody tr").forEach(r => {
        r.style.display = r.innerText.toLowerCase().includes(val) ? "" : "none";
    });
});

fetchCandidates();

</script>

</body>
</html>
